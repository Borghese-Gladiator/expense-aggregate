# Expense Aggregation
## Usage Instructions
- download transaction history
  - rename statements to include company name (can use `Powershell` script potentially)
    - if company not present in "company enum", write company parse logic in "find_transactions_table" and "normalize_transaction_df"
- update script "CONSTANTS"
- run locally
  ```
  poetry install
  poetry shell
  python main.py
  ```

## Notes
Bootstrap Steps
- `poetry init`
- `git init`
- write `.gitignore` using online `Python.gitignore`
- `poetry add loguru tabula-py[jpype] pandas`
  - NOTE: `tabula` is a package, but not related to reading PDFs
- write main.py
- download `financial_transaction_history` from all my credit card companies
- > write methodology
- [X] download PDFs
- [ ] extract tables from PDFs to build transactions list CSV
- build Excel spreadsheet from aggregated table
  - add default column of rent_applicable_transaction
- build subset Excel spreadsheet of rent applicable transactions using column

Warnings
- pypdf
  - extract text and manually filter using index per type of PDF instead
- camelot
  - NOTE: `poetry add camelot-py[base]` (NOT `camelot`)
  - camelot-py installation
    - use Python 3.8 - depends on `pdftopng 0.2.3` which requires Python 3.8, 3.7, or 3.6.
    - `poetry add opencv-python`
    - download [Ghostscript](https://ghostscript.com/releases/gsdnld.html)
      - check installed with either command:
        - `gswin64c --version`
        - ```python
          import ctypes
          from ctypes.util import find_library
          find_library("".join(("gsdll", str(ctypes.sizeof(ctypes.c_voidp) * 8), ".dll")))
          ```
    - `poetry add ghostscript`
  - CLI usage
    - `camelot lattice -plot text .\capital_one_Smry_2023_1496.pdf`
      - `poetry add matplotlib` - `ImportError: matplotlib is required for plotting.`
  - NOTE: Did not find any text and could not figure out how to customize
- tabula
  - NOTE: `poetry add tabula-py`
  - > WARNING: The stream doesn't provide any stream length, using fallback readUntilEnd, at offset 64514
  - This warning indicates that the library is unable to determine the length of the PDF stream, so it falls back to a method called readUntilEnd.
  - Tabula works for basic tables, but my financial documents require customization. Tabula customizes via template which are generated by the desktop app.
    - the Tabula desktop app requires installation of ORACLE Java 8. Using OpenJDK 8 (Zulu) does not seem to work. Oracle Java 8 does not ship with an installer and requires manual config (JAVA_HOME I assume?). Either way, I elected against spending more effort on Java 8 which I would need to uninstall manually

### Methodology
Method A
- download PDFs
- extract tables from PDFs to build transactions list CSV
- build Excel spreadsheet from aggregated table
  - add default column of rent_applicable_transaction
- build subset Excel spreadsheet of rent applicable transactions using column

Method B
- download PDFs
- extract tables from PDFs to build transactions list CSV
- build Next.js webapp
	- display list of transactions in Material Table (filter + sort columns)
	- display list of J Shee transactions via hard-coded code
	- deploy to Vercel

### Troubleshooting

```
Package operations: 1 install, 0 updates, 0 removals

  - Installing pdftopng (0.2.3): Failed

  RuntimeError

  Unable to find installation candidates for pdftopng (0.2.3)

  at ~\AppData\Roaming\pypoetry\venv\lib\site-packages\poetry\installation\chooser.py:74 in choose_for
       70│
       71│             links.append(link)
       72│
       73│         if not links:
    →  74│             raise RuntimeError(f"Unable to find installation candidates for {package}")
       75│
       76│         # Get the best link
       77│         chosen = max(links, key=lambda link: self._sort_key(package, link))
       78│

Cannot install pdftopng.
```